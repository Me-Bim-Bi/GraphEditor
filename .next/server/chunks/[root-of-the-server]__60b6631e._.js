module.exports = [
"[project]/Workspaces/Thanhs-Workspaces/GraphEditor/.next-internal/server/app/api/import-graph/route/actions.js [app-rsc] (server actions loader, ecmascript)", ((__turbopack_context__, module, exports) => {

}),
"[externals]/next/dist/compiled/next-server/app-route-turbo.runtime.dev.js [external] (next/dist/compiled/next-server/app-route-turbo.runtime.dev.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/compiled/next-server/app-route-turbo.runtime.dev.js", () => require("next/dist/compiled/next-server/app-route-turbo.runtime.dev.js"));

module.exports = mod;
}),
"[externals]/next/dist/compiled/@opentelemetry/api [external] (next/dist/compiled/@opentelemetry/api, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/compiled/@opentelemetry/api", () => require("next/dist/compiled/@opentelemetry/api"));

module.exports = mod;
}),
"[externals]/next/dist/compiled/next-server/app-page-turbo.runtime.dev.js [external] (next/dist/compiled/next-server/app-page-turbo.runtime.dev.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/compiled/next-server/app-page-turbo.runtime.dev.js", () => require("next/dist/compiled/next-server/app-page-turbo.runtime.dev.js"));

module.exports = mod;
}),
"[externals]/next/dist/server/app-render/work-unit-async-storage.external.js [external] (next/dist/server/app-render/work-unit-async-storage.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/server/app-render/work-unit-async-storage.external.js", () => require("next/dist/server/app-render/work-unit-async-storage.external.js"));

module.exports = mod;
}),
"[externals]/next/dist/server/app-render/work-async-storage.external.js [external] (next/dist/server/app-render/work-async-storage.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/server/app-render/work-async-storage.external.js", () => require("next/dist/server/app-render/work-async-storage.external.js"));

module.exports = mod;
}),
"[externals]/next/dist/shared/lib/no-fallback-error.external.js [external] (next/dist/shared/lib/no-fallback-error.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/shared/lib/no-fallback-error.external.js", () => require("next/dist/shared/lib/no-fallback-error.external.js"));

module.exports = mod;
}),
"[externals]/next/dist/server/app-render/after-task-async-storage.external.js [external] (next/dist/server/app-render/after-task-async-storage.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/server/app-render/after-task-async-storage.external.js", () => require("next/dist/server/app-render/after-task-async-storage.external.js"));

module.exports = mod;
}),
"[externals]/next/dist/server/app-render/action-async-storage.external.js [external] (next/dist/server/app-render/action-async-storage.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/server/app-render/action-async-storage.external.js", () => require("next/dist/server/app-render/action-async-storage.external.js"));

module.exports = mod;
}),
"[externals]/os [external] (os, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("os", () => require("os"));

module.exports = mod;
}),
"[externals]/net [external] (net, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("net", () => require("net"));

module.exports = mod;
}),
"[externals]/tls [external] (tls, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("tls", () => require("tls"));

module.exports = mod;
}),
"[externals]/fs [external] (fs, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("fs", () => require("fs"));

module.exports = mod;
}),
"[externals]/buffer [external] (buffer, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("buffer", () => require("buffer"));

module.exports = mod;
}),
"[externals]/dns [external] (dns, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("dns", () => require("dns"));

module.exports = mod;
}),
"[externals]/string_decoder [external] (string_decoder, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("string_decoder", () => require("string_decoder"));

module.exports = mod;
}),
"[project]/Workspaces/Thanhs-Workspaces/GraphEditor/src/app/lib/neo4j.ts [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "cleanDatabase",
    ()=>cleanDatabase,
    "communityDetection",
    ()=>communityDetection,
    "connectedComponents",
    ()=>connectedComponents,
    "createGraph",
    ()=>createGraph,
    "degreeCentrality",
    ()=>degreeCentrality,
    "dropGraph",
    ()=>dropGraph,
    "getNeighbors",
    ()=>getNeighbors,
    "getSession",
    ()=>getSession,
    "getShortestPath",
    ()=>getShortestPath,
    "pageRank",
    ()=>pageRank
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$Workspaces$2f$Thanhs$2d$Workspaces$2f$GraphEditor$2f$node_modules$2f2e$pnpm$2f$neo4j$2d$driver$40$5$2e$28$2e$2$2f$node_modules$2f$neo4j$2d$driver$2f$lib$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/Workspaces/Thanhs-Workspaces/GraphEditor/node_modules/.pnpm/neo4j-driver@5.28.2/node_modules/neo4j-driver/lib/index.js [app-route] (ecmascript)");
;
const driver = __TURBOPACK__imported__module__$5b$project$5d2f$Workspaces$2f$Thanhs$2d$Workspaces$2f$GraphEditor$2f$node_modules$2f2e$pnpm$2f$neo4j$2d$driver$40$5$2e$28$2e$2$2f$node_modules$2f$neo4j$2d$driver$2f$lib$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"].driver(process.env.NEO4J_URI || 'bolt://localhost:7687', __TURBOPACK__imported__module__$5b$project$5d2f$Workspaces$2f$Thanhs$2d$Workspaces$2f$GraphEditor$2f$node_modules$2f2e$pnpm$2f$neo4j$2d$driver$40$5$2e$28$2e$2$2f$node_modules$2f$neo4j$2d$driver$2f$lib$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"].auth.basic(process.env.NEO4J_USERNAME, process.env.NEO4J_PASSWORD));
const getSession = ()=>driver.session();
async function cleanDatabase() {
    const session = driver.session();
    try {
        await session.run(`
        MATCH (n)
        DETACH DELETE n
    `);
        console.log('Database cleaned successfully.');
    } catch (error) {
        console.error('Error cleaning database:', error);
    } finally{
        await session.close();
    }
}
async function dropGraph() {
    const session = driver.session();
    try {
        await session.run(`
        CALL gds.graph.drop('TestGraph')
        YIELD graphName
    `);
        console.log('Graph dropped successfully.');
    } catch (error) {
        console.error('Error dropping graph:', error);
    } finally{
        await session.close();
    }
}
async function createGraph() {
    const session = driver.session();
    try {
        const relTypesResult = await session.run(`CALL db.relationshipTypes()`);
        const relTypes = relTypesResult.records.map((r)=>r.get(0));
        if (relTypes.length === 0) {
            throw new Error('No relationship found in database!');
        }
        const relProjection = relTypes.map((type)=>`${type}: {orientation: 'NATURAL', properties: ['value']}`).join(',\n                        ');
        const cypher = `
            CALL gds.graph.project(
                'TestGraph',
                'Node',
                {
                    ${relProjection}
                }
            )
        `;
        await session.run(cypher);
        console.log(`Graph created successfully with relationships: ${relTypes.join(', ')}`);
    } catch (error) {
        console.error('Error creating graph:', error);
    } finally{
        await session.close();
    }
}
async function getShortestPath(startId, endId) {
    const session = driver.session();
    try {
        const result = await session.run(`
            MATCH (source:Node {id: '${startId}'}), (target:Node {id: '${endId}'})
            CALL gds.shortestPath.dijkstra.stream('TestGraph', {
                sourceNode: id(source),
                targetNodes: id(target),
                relationshipWeightProperty: 'value'
            })
            YIELD index, sourceNode, targetNode, totalCost, nodeIds, costs, path
            RETURN
                index,
                gds.util.asNode(sourceNode).label AS sourceNodeName,
                gds.util.asNode(targetNode).label AS targetNodeName,
                totalCost,
                [nodeId IN nodeIds | gds.util.asNode(nodeId).label] AS nodeNames,
                costs,
                nodes(path) as path
            ORDER BY index
            `);
        return result;
    } catch (error) {
        console.error('Error fetching shortest path:', error);
        throw error;
    } finally{
        await session.close();
    }
}
async function communityDetection() {
    const session = driver.session();
    try {
        const result = await session.run(`
        CALL gds.louvain.stream('TestGraph')
        YIELD nodeId, communityId
        WITH gds.util.asNode(nodeId) AS node, communityId
        OPTIONAL MATCH (parent:Node)-[:PARENT_CHILD]->(node)
        RETURN 
            node.id AS id,
            node.label AS node,
            communityId AS score,
            parent.id AS parentID
        ORDER BY communityId DESC, node ASC
            `);
        return result;
    } catch (error) {
        console.error('Error performing community detection:', error);
        throw error;
    } finally{
        await session.close();
    }
}
async function pageRank() {
    const session = driver.session();
    try {
        const result = await session.run(`
            CALL gds.pageRank.stream('TestGraph')
            YIELD nodeId, score
            WITH gds.util.asNode(nodeId) AS node, score
            OPTIONAL MATCH (parent:Node)-[:PARENT_CHILD]->(node)
            RETURN 
                node.id AS id,
                node.label AS node,
                score,
                parent.id AS parentID
            ORDER BY score DESC, node ASC
            `);
        return result;
    } catch (error) {
        console.error('Error performing page rank:', error);
        throw error;
    } finally{
        await session.close();
    }
}
async function degreeCentrality() {
    const session = driver.session();
    try {
        const result = await session.run(`
            CALL gds.degree.stream('TestGraph')
            YIELD nodeId, score
            WITH gds.util.asNode(nodeId) AS node, score
            OPTIONAL MATCH (parent:Node)-[:PARENT_CHILD]->(node)
            RETURN
                node.id AS id,
                node.label AS node,
                score,
                parent.id AS parentID
            ORDER BY score DESC, node ASC
            `);
        return result;
    } catch (error) {
        console.error('Error performing degree centrality:', error);
        throw error;
    } finally{
        await session.close();
    }
}
async function connectedComponents() {
    const session = driver.session();
    try {
        const result = await session.run(`
            CALL gds.scc.stream('TestGraph')
            YIELD nodeId, componentId
            WITH gds.util.asNode(nodeId) AS node, componentId AS score
            OPTIONAL MATCH (parent:Node)-[:PARENT_CHILD]->(node)
            RETURN
                node.id AS id,
                node.label AS node,
                score,
                parent.id AS parentID
            ORDER BY score DESC, node ASC

            `);
        return result;
    } catch (error) {
        console.error('Error performing strong connected components:', error);
        throw error;
    } finally{
        await session.close();
    }
}
async function getNeighbors(findNeighborsLabel, hop) {
    const session = driver.session();
    try {
        const hopNum = Math.min(Number(hop) || 1, 5);
        const relTypesResult = await session.run(`CALL db.relationshipTypes()`);
        const relTypes = relTypesResult.records.map((r)=>r.get(0));
        if (relTypes.length === 0) {
            throw new Error('No relationship types found in database!');
        }
        const relPattern = relTypes.join('|');
        const query = `
      MATCH p=(n:Node {id: $findNeighborsLabel})-[:${relPattern}*1..${hopNum}]-(m:Node)
      RETURN p
    `;
        const result = await session.run(query, {
            findNeighborsLabel
        });
        return result;
    } catch (error) {
        console.error('Error finding neighbors:', error);
        throw error;
    } finally{
        await session.close();
    }
}
}),
"[project]/Workspaces/Thanhs-Workspaces/GraphEditor/src/app/api/import-graph/route.ts [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "POST",
    ()=>POST
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$Workspaces$2f$Thanhs$2d$Workspaces$2f$GraphEditor$2f$node_modules$2f2e$pnpm$2f$next$40$15$2e$5$2e$2_$40$babel$2b$core$40$7$2e$28$2e$4_react$2d$dom$40$19$2e$1$2e$0_react$40$19$2e$1$2e$0_$5f$react$40$19$2e$1$2e$0$2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/Workspaces/Thanhs-Workspaces/GraphEditor/node_modules/.pnpm/next@15.5.2_@babel+core@7.28.4_react-dom@19.1.0_react@19.1.0__react@19.1.0/node_modules/next/server.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$Workspaces$2f$Thanhs$2d$Workspaces$2f$GraphEditor$2f$src$2f$app$2f$lib$2f$neo4j$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/Workspaces/Thanhs-Workspaces/GraphEditor/src/app/lib/neo4j.ts [app-route] (ecmascript)");
;
;
async function POST(req) {
    const data = await req.json();
    const session = (0, __TURBOPACK__imported__module__$5b$project$5d2f$Workspaces$2f$Thanhs$2d$Workspaces$2f$GraphEditor$2f$src$2f$app$2f$lib$2f$neo4j$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getSession"])();
    await (0, __TURBOPACK__imported__module__$5b$project$5d2f$Workspaces$2f$Thanhs$2d$Workspaces$2f$GraphEditor$2f$src$2f$app$2f$lib$2f$neo4j$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["cleanDatabase"])();
    try {
        // Create or update all nodes
        for (const node of data.nodes){
            await session.run(`
                MERGE (n:Node {id: $id})
                SET n.label = $label,
                    n.x = $x,
                    n.y = $y,
                    n.parentID = $parentID,
                    n.color = $color,
                    n.additionalProperties = $additionalProperties
                `, {
                id: node.id,
                label: node.label ?? null,
                x: node.x ?? null,
                y: node.y ?? null,
                parentID: node.parentID ?? null,
                color: node.color ?? null,
                additionalProperties: node.textList ? node.textList.join('; ') : null
            });
        }
        // Import edges (with dynamic relationship types)
        for (const link of data.links){
            const sourceId = typeof link.source === 'string' ? link.source : link.source.id;
            const targetId = typeof link.target === 'string' ? link.target : link.target.id;
            // Default to "LINK" if relationship is missing
            const relType = link.relationship && link.relationship.trim() !== '' ? link.relationship.replace(/[^A-Za-z0-9_]/g, '_').toUpperCase() : 'LINK';
            const cypher = `
                MERGE (a:Node {id: $sourceId})
                MERGE (b:Node {id: $targetId})
                MERGE (a)-[r:${relType}]->(b)
                SET r.value = $value,
                    r.color = $color,
                    r.arrowShape = $arrowShape
            `;
            await session.run(cypher, {
                sourceId,
                targetId,
                value: link.value ?? null,
                color: link.color ?? null,
                arrowShape: link.arrowShape ?? null
            });
        }
        // console.log("cypher: ", data);
        return __TURBOPACK__imported__module__$5b$project$5d2f$Workspaces$2f$Thanhs$2d$Workspaces$2f$GraphEditor$2f$node_modules$2f2e$pnpm$2f$next$40$15$2e$5$2e$2_$40$babel$2b$core$40$7$2e$28$2e$4_react$2d$dom$40$19$2e$1$2e$0_react$40$19$2e$1$2e$0_$5f$react$40$19$2e$1$2e$0$2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            message: 'Graph imported successfully'
        });
    } catch (error) {
        console.error(error);
        return __TURBOPACK__imported__module__$5b$project$5d2f$Workspaces$2f$Thanhs$2d$Workspaces$2f$GraphEditor$2f$node_modules$2f2e$pnpm$2f$next$40$15$2e$5$2e$2_$40$babel$2b$core$40$7$2e$28$2e$4_react$2d$dom$40$19$2e$1$2e$0_react$40$19$2e$1$2e$0_$5f$react$40$19$2e$1$2e$0$2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            message: 'Error importing graph',
            error
        }, {
            status: 500
        });
    } finally{
        await session.close();
    }
}
}),
];

//# sourceMappingURL=%5Broot-of-the-server%5D__60b6631e._.js.map